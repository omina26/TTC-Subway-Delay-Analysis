---
title: "About"
output: html_document
---

### Introduction

As businesses increasingly encourage employees to return to in-oﬀice work, reliable transporta- tion is becoming more important than ever for commuters. Many workers rely on subway systems for their daily commutes. Subway delays can disrupt schedules, increase travel time uncertainty, and even influence long-term decisions about where people choose to live or work. While some delays may be unavoidable, understanding when and where these delays occur, as well as how external factors like weather conditions and population density contribute to service disruptions can help both commuters and policymakers make informed decisions.

Motivated by the question, “What factors affect subway delays on Toronto’s TTC?”, this study investigates when and where subway delays occur within the Toronto Transit Com- mission (TTC) system, analyzes the impact of weather conditions and service population density on these delays, and uses machine learning to predict the duration of subway delays. A merged dataset was constructed using multiple sources. Subway delay reports (see reference) were obtained from the City of Toronto Open Data Catalogue, providing details on location, time, and cause of delays across the TTC subway network. Service population estimates were derived from Toronto Neighbourhood Profiles (see reference), also sourced from the Open Data Catalogue, while spatial data for neighbourhoods and station locations was incorporated using the Toronto Neighbourhoods shapefile (see reference), TTC Subway and Streetcar Map (see reference) and OpenStreetMap API (see reference). Additionally, hourly weather data from 2024 was retrieved using the Open-meteo API (see reference), allowing for an assessment of temperature, precipitation, and other environmental factors at the time of each recorded delay.

### Methodology

To analyze the occurrence of subway delays and the potential impact of weather conditions and population density, this study integrates multiple datasets, combining transit delay re- ports, weather data, and demographic information. The TTC Subway Delay Data from 2024, acquired from the City of Toronto Open Data Catalogue, consists of 26,467 entries with de- tails on the date, time, day of the week, station, delay code (cause of delay), minutes of delay, minutes of gap between trains, train direction (bound), subway line, and vehicle ID. For this analysis, all columns were retained except for minutes of gap between trains and vehicle ID. To account for population density, Toronto Neighbourhood Profiles data from 2021, also sourced from the City of Toronto Open Data Catalogue, was incorporated. This dataset includes 158 entries with demographic information, from which only neighbourhood ID and total popu- lation were used to estimate the service population surrounding each station. Additionally, Toronto Neighbourhoods shapefile data, obtained from the City of Toronto Open Data Cata- logue, contained 158 entries and 12 columns and was used for geographic mapping.

To further enrich the analysis, a custom subway station dataframe was created by manually collecting the names of all 70 subway stations from the TTC Subway and Streetcar Map and retrieving station longitude and latitude coordinates using the OpenStreetMap API to allow for spatial integration with other dataframes. Weather conditions were incorporated using hourly weather data from 2024, retrieved from the Open-Meteo API, which contained 8,784 entries with columns detailing the date, temperature, relative humidity, apparent temperature, precipitation, rain, snowfall, snow depth, cloud cover, wind speed, wind direction, and wind gusts. All columns from this dataset were used to assess the impact of different weather variables on subway delays.

Once collected, the datasets underwent extensive cleaning and preprocessing to ensure con- sistency and usability. The TTC Subway Delay Data, originally containing 10 columns, was filtered to remove minutes of gap between trains and vehicle ID. Columns were renamed for clarity, and duplicate rows or rows with null values in the bound or line columns were removed. Subway station names were standardized, and a new hour column was created to facilitate merging with the weather dataframe. The day, station, code, bound, and line columns were converted to categorical types to improve usability during analysis. Most importantly, only observations with delays greater than zero minutes and less than or equal to 30 minutes were retained, reducing the dataset to 9,038 rows. The population dataframe was created by filtering the Toronto Neighbourhood Profiles data to retain only neighbourhood ID and population estimates. In the weather dataset, null values in the snow depth column were filled with zero, and an hour column was generated from the date column.

Data wrangling was performed to integrate these datasets into a unified structure. First, the Toronto Neighbourhoods shapefile was merged with the population dataframe using neighbour- hood IDs. Next, the stations dataframe was spatially joined with the neighbourhoods shapefile to identify neighborhoods within 0.5 km of a station, allowing service population estimates to be merged into the stations dataframe. The delay dataframe and weather dataframe were then merged on date and hour to create a comprehensive dataset. Finally, service population counts for each station were merged into this final dataset using station names as the key identifier.

To understand patterns in subway delays, summary statistics were computed for all numerical variables in the dataset. A histogram was generated to visualize the distribution of delay durations, highlighting the frequency of different delay times. The most common delay codes were identified, and their frequency was plotted to determine the predominant causes of disruptions. Additionally, delays were analyzed across subway lines, train directions (bounds), and stations to assess variations in delay occurrence by location.

Temporal analysis was conducted by examining delay frequencies and average delay durations by hour of the day. A bar plot illustrated the number of delays per hour, while a line plot showed fluctuations in average delay durations throughout the day. Spatial trends were further explored by identifying the top three stations per subway line with the highest delay occur- rences and comparing their average delay durations. A regression analysis was performed to evaluate the relationship between service population and delay duration, providing insights into whether higher-density areas experience more frequent or prolonged delays.

A correlation heatmap was generated to assess relationships between weather variables and subway delays. Finally, an ANOVA test was conducted to determine whether delay durations significantly differed across days of the week, stations, subway lines, and subway bounds, offering statistical validation of observed trends.

As part of the exploratory phase, three interactive visualizations were created using R to better understand subway delay patterns. First, a delay frequency map was generated using the `leaflet` package, displaying the total number of delays at each subway station using scaled circle markers, with popups showing station-level service population. Second, a scatterplot was created with `plotly` to visualize the relationship between service population and average delay duration, grouped by station and subway line. This allowed identification of outliers and variability in delay severity across different areas. Third, a heatmap of delay frequency by hour of day and day of week was constructed using `plotly`, highlighting temporal patterns in delays, such as peaks during rush hours or weekends. These visualizations provided insight into when and where delays were most frequent, and guided feature selection for the modeling stage.

To predict TTC subway delay durations, five supervised learning models were trained and compared using a 70/30 train-test split. All modeling was conducted in R, and performance was evaluated using three key metrics:

- Root Mean Squared Error (RMSE): Measures the square root of the average squared differences between predicted and actual values. It penalizes larger errors more heavily and is expressed in the same units as the target variable (minutes).
- Mean Absolute Error (MAE): Calculates the average absolute difference between predictions and actual outcomes. It provides a straightforward interpretation of the average error in minutes.
- R-squared (R²): Represents the proportion of variance in the response variable explained by the model. Higher R² values indicate better explanatory power.

Thirteen predictors were used in all models, including weather conditions, station, subway line, direction, service population, and time of day.

The Generalized Linear Model (GLM) with a Gamma family and log link was selected to model delay duration as a positively right-skewed continuous variable. Categorical variables and continuous predictors were used. The Generalized Additive Model (GAM) was fit using the same predictors, with smooth functions applied to continuous variables to capture non-linear effects. In both cases, predictor significance was assessed using model summary statistics.

The Random Forest model was implemented using the `ranger` method. This ensemble method builds multiple decision trees on bootstrapped subsets and averages predictions to reduce variance. It handles high-cardinality categorical features like station effectively. Tuning was performed over number of predictors at each split and minimum node size. The Gradient Boosting (GBM) model was trained using the `gbm` method, which builds trees sequentially, each trying to correct the residuals of the previous model. Its tuning involved number of trees, tree depth, learning rate, and minimum observations per node. XGBoost, an optimized implementation of gradient boosting, was trained using one-hot encoded predictors. It was tuned over a wide range of hyperparameters including number of rounds, maximum tree depth, learning rate, regularization term, column subsample ratio, minimum child weight, and row subsample ratio. For these three models, hyperparameters were tuned using 5-fold cross-validation, and varaible importance plots were generated. These plots helped identify the most significant predictors of delay duration based on impurity reduction and model contribution. The three plots were combined into a single visualization to highlight consistently important features across models.

Lastly, after fitting, predictions were generated for both training and test sets, and a comparison table was created to summarize each model’s performance. The best model was defined as the one with the lowest RMSE and MAE, and the highest R² on the test set.


